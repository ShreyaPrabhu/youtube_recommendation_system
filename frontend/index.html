<!DOCTYPE html>
  <html>
    <head>
      <!-- Compiled and minified CSS -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

      <!-- Compiled and minified JavaScript -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

      <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->
      <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>

      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </head>

    <nav>
    <div class="nav-wrapper">
      <div class="row">
      <a href="#" class="brand-logo">Youtube Learning Recommendations</a>
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li><a href="https://github.com/ShreyaPrabhu/youtube_recommendation_system"><img src="github.png" style = "padding-top:8px;height:43px;width:36px"></a></li>
      </ul>
      </div>
      </div>
  </nav>

  <nav>
    <div class="nav-wrapper">
      <form>
        <div class="input-field">
          <input id="search" type="search" required>
          <label class="label-icon" for="search"><i class="material-icons">search</i></label>
          <i class="material-icons" id="close">close</i>
        </div>
      </form>
    </div>
  </nav>
    <body>

      <div class="response" id="response">
      </div>

      <script>

        document.getElementById('search').addEventListener('input', function(){
            if(this.value != "") document.getElementById('close').style.opacity = 1
            else document.getElementById('close').style.opacity = 0
          });

        document.getElementById('close').addEventListener('click', function(){
          document.getElementById('search').value = "";
          document.getElementById('response').innerHTML = "";
          this.style.opacity = 0
        });

        document.getElementById("search").onkeypress = function(e) {
          var key = e.charCode || e.keyCode || 0;
          if (key == 13) {
            callSearch(this.value)
            e.preventDefault();
          }
        }

        function buildCard(items) {
          var body = document.getElementsByClassName('response')[0];
          body.innerHTML = "";
          var divrow = document.createElement('div');
          divrow.className = 'row'
          for (var i = 0; i < items.length; i++) {
            var divcol = document.createElement('div');
            divcol.className = 'col s8 m4 offset-s2'
            var divcard = document.createElement('div');
            divcard.className = 'card'
            divcard.style.width = "400px"
            divcard.style.height = "600px"
            var divcardImg = document.createElement('div');
            divcardImg.className = 'card-image'
            var img = document.createElement('img');
            img.src = items[i].snippet.thumbnails.high.url
            img.className = "square"
            divcardImg.appendChild(img)
            var divcardContent = document.createElement('div');
            divcardContent.className = 'card-content'
            var span = document.createElement('span');
            span.className = "card-title"
            var title = document.createTextNode(items[i].snippet.title);
            span.appendChild(title)
            divcardContent.appendChild(span)
            var p = document.createElement('p');
            var channelTitle = document.createTextNode(items[i].snippet.channelTitle);
            var description = document.createTextNode(items[i].snippet.description);
            p.appendChild(channelTitle)
            p.appendChild(description)
            divcardContent.appendChild(p)
            divcard.appendChild(divcardImg)
            divcard.appendChild(divcardContent)
            divcol.appendChild(divcard)
            divrow.appendChild(divcol)
            if((i+1)%3 == 0) {
              body.appendChild(divrow)
              divrow = document.createElement('div');
              divrow.className = 'row'
              divcol = document.createElement('div');
              divcol.className = 'col s8 m4 offset-s2'
            }
          }
        }

        function callSearch(value) {
          var xhttp = new XMLHttpRequest();
          xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                json = JSON.parse(this.responseText);
                var items = json.items;
                buildCard(items)
            }
            if(this.readyState == 4 && this.status == 400) {
                alert("Bad request provided!!")
            }
            if(this.readyState == 4 && this.status == 500) {
                alert("Oops!! Internal server error. We will fix this soon.")
            }
          };
          xhttp.open("GET", "http://127.0.0.1:5000/search?search_query=" + value, true);
          xhttp.setRequestHeader('Content-Type', 'application/json');
          xhttp.setRequestHeader('Access-Control-Allow-Headers', 'Content-Type');
          xhttp.send();
        }
    </script>
    </body>
  </html>
